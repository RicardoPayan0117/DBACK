<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Solicita nuestro servicio de grúas 24/7. Asistencia rápida y profesional para todo tipo de vehículos.">
    <title>Solicitar Servicio de Grúa | Grúas DBACK</title>
    <link rel="stylesheet" href=".\CSS\Solicitud_ARCO.CSS">
</head>
<body>
<nav class="navbar">
    <div class="nav-content">
        <!-- Parte izquierda: Logo y nombre -->
        <a href="index.html" class="navbar-brand">
            <img src="Elementos\LogoDBACK.png" alt="Logo DBACK">
            <h1>Grúas DBACK</h1>
        </a>
        
        <!-- Parte derecha: Enlaces y botón de llamada -->
        <div class="nav-links">
            <a href="tel:+526688253351" class="cta-button accent">Llamar ahora</a>
        </div>
    </div>
</nav>   

    <section class="formulario">
        <h2>Solicitar Servicio de Grúa</h2>
        <p class="form-description">Complete el formulario y nos pondremos en contacto lo antes posible.</p>
        <form action="procesar_formulario.php" method="post" id="servicioForm" onsubmit="return validarYEnviarFormulario(event)">
            <div class="form-group">
                <label for="nombre">Nombre completo:</label>
                <input type="text" id="nombre" name="nombre" required 
                       pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]{3,50}"
                       placeholder="Ej: Pito Pérez"
                       title="Ingrese un nombre válido (solo letras y espacios, mínimo 3 caracteres)">
            </div>

            <div class="form-group">
                <label for="telefono">Teléfono de contacto:</label>
                <input type="tel" id="telefono" name="telefono" required 
                       pattern="[0-9]{3}[-][0-9]{3}[-][0-9]{4}"
                       placeholder="Ej: 123-456-7890"
                       title="Formato requerido: XXX-XXX-XXXX">
            </div>

            <div class="form-group">
                <label for="email">Correo electrónico:</label>
                <input type="email" id="email" name="email" 
                       pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                       placeholder="Ej: juan@ejemplo.com"
                       title="Ingrese un correo electrónico válido">
            </div>

            <div class="form-group">
                <label for="ubicacion">Ubicación actual:</label>
                <input type="text" id="ubicacion" name="ubicacion" required 
                       minlength="5"
                       placeholder="Dirección o punto de referencia" 
                       list="ubicaciones"
                       title="Ingrese una ubicación válida (mínimo 5 caracteres)">
                <datalist id="ubicaciones"></datalist>
            </div>

            <div class="form-group">
                <label for="vehiculo">Tipo de vehículo:</label>
                <select id="vehiculo" name="vehiculo" required>
                    <option value="">Seleccione una opción</option>
                    <option value="automovil">Automóvil</option>
                    <option value="camioneta">Camioneta</option>
                    <option value="motocicleta">Motocicleta</option>
                    <option value="camion">Camión</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tipo_servicio">Tipo de Servicio:</label>
                <select id="tipo_servicio" name="tipo_servicio" required>
                    <option value="">Seleccione una opción</option>
                    <option value="remolque">Remolque</option>
                    <option value="bateria">Cambio de batería</option>
                    <option value="gasolina">Suministro de gasolina</option>
                    <option value="llanta">Cambio de llanta</option>
                    <option value="arranque">Servicio de arranque</option>
                    <option value="otro">Otro servicio</option>
                </select>
            </div>

            <div class="form-group">
                <label for="descripcion">Descripción del problema:</label>
                <textarea id="descripcion" name="descripcion" rows="4" 
                          minlength="10" maxlength="500"
                          placeholder="Describa brevemente la situación"
                          title="La descripción debe tener entre 10 y 500 caracteres"></textarea>
            </div>

            <div class="form-group">
                <label for="urgencia">Nivel de urgencia:</label>
                <select id="urgencia" name="urgencia" required>
                    <option value="normal">Normal</option>
                    <option value="urgente">Urgente</option>
                    <option value="emergencia">Emergencia</option>
                </select>
            </div>
            
            <!-- Checkbox para confirmar consentimiento -->
            <div id="privacy-container" class="privacy-checkbox-container">
                <input type="checkbox" id="consentimiento" name="consentimiento" required>
                <label for="consentimiento"><span class="privacy-text">He leído y acepto la <span class="privacy-link" id="openConsentModal">política de privacidad</span></span></label>
            </div>

            <button type="submit" class="cta-button">Enviar Solicitud</button>
        </form>
        <p class="emergency-note">Para emergencias inmediatas, llame al <a href="tel:+1234567890" class="emergency-phone">123-456-7890</a></p>
    </section>

    <!-- Modal de política de privacidad -->
    <div id="consentModal" class="modal-overlay">
        <div class="modal-container">
            <button class="close-modal" id="closeModal">&times;</button>
            
            <div class="header-decoration">
                <h1>Consentimiento de Datos Personales</h1>
            </div>
            
            <p>Por este medio, expreso y otorgo mi consentimiento a Grúas DBACK en la recopilación, almacenamiento y uso de mis datos personales, con los fines relacionados con la prestación y uso de los servicios prestados por Grúas DBACK, tales como solicitudes de asistencia, el seguimiento de vehículos atendidos y la emisión de recibos o facturas de pago correspondiente.</p>
            
            <h2>Datos personales recopilados</h2>
            <ul>
                <li>Nombre completo</li>
                <li>Domicilio</li>
                <li>Número de teléfono</li>
                <li>Correo electrónico</li>
                <li>Datos del vehículo</li>
                <li>Información de la solicitud de servicio</li>
                <li>Ubicación del servicio</li>
                <li>Fecha y hora de la solicitud</li>
            </ul>
            
            <h2>Tratamiento de datos</h2>
            <p>La información recopilada será tratada en estricto apego a lo establecido por la Ley Federal de Protección de Datos Personales en Posesión de los Particulares y será utilizada exclusivamente para los fines mencionados.</p>
            
            <h2>Medios de contacto de Grúas DBACK para ejercer mis derechos ARCO</h2>
            <p>Para más información sobre los derechos ARCO, visita: <a href="https://www.gob.mx/cms/uploads/attachment/file/428335/DDP_Gu_a_derechos_ARCO_13Dic18.pdf" target="_blank">Guía Derechos ARCO</a></p>
            <p>Correo electrónico: <a href="mailto:protecciondedatos@gruasdback.com">protecciondedatos@gruasdback.com</a></p>
            <p>Teléfono: <a href="tel:6688132905">668 813 2905</a></p>
            <p>Dirección: Manuel Castro Elizalde 895 SUR, Luis Donaldo Colosio, Colón, 81233 Los Mochis, Sin.</p>
            
            <h2>Consentimiento</h2>
            <p>Al hacer clic en "Aceptar", confirmo que he leído y comprendido los términos de esta autorización y que otorgo mi consentimiento para el tratamiento de mis datos personales a Grúas DBACK.</p>
            
            <div class="button-container">
                <a href="#" class="button" id="acceptConsent">Aceptar</a>
                <a href="#" class="button button-reject" id="rejectConsent">Rechazar</a>
            </div>
            
            <div class="footer-decoration">
                <p>Grúas DBACK - Documento de Consentimiento de Datos Personales</p>
            </div>
        </div>
    </div>
    
    <!-- Modal de notificación de rechazo -->
    <div id="rejectModal" class="modal-overlay">
        <div class="small-modal-container">
            <h2>Consentimiento Requerido</h2>
            <p>Debe aceptar la política de privacidad para utilizar nuestros servicios. 
                No podemos procesar su solicitud sin su consentimiento para el tratamiento de datos personales.</p>
            <button class="notification-button" id="closeRejectModal">Entendido</button>
        </div>
    </div>
    
    <!-- Modal de éxito al enviar -->
    <div id="successModal" class="success-modal-overlay">
        <div class="success-modal-container">
            <h2>¡Solicitud Enviada!</h2>
            <p>Su solicitud se ha enviado con éxito.</p>
            <p>Nos pondremos en contacto con usted a la brevedad posible.</p>
            <button class="success-button" id="closeSuccessModal">Aceptar</button>
        </div>
    </div>

    <script>
        // Script para controlar la apertura y cierre de los modales
        document.addEventListener('DOMContentLoaded', function() {
            const consentModal = document.getElementById('consentModal');
            const rejectModal = document.getElementById('rejectModal');
            const successModal = document.getElementById('successModal');
            const openLink = document.getElementById('openConsentModal');
            const closeButton = document.getElementById('closeModal');
            const acceptButton = document.getElementById('acceptConsent');
            const rejectButton = document.getElementById('rejectConsent');
            const closeRejectButton = document.getElementById('closeRejectModal');
            const closeSuccessButton = document.getElementById('closeSuccessModal');
            const consentCheckbox = document.getElementById('consentimiento');
            const privacyContainer = document.getElementById('privacy-container');
            
            // Verificar si ya existe consentimiento previo
            if (localStorage.getItem('dataConsent') === 'accepted') {
                consentCheckbox.checked = true;
                privacyContainer.classList.add('privacy-accepted');
            }
            
            // Abrir el modal al hacer clic en el enlace
            openLink.addEventListener('click', function() {
                consentModal.style.display = 'flex';
                document.body.style.overflow = 'hidden'; // Evitar scroll en el fondo
            });
            
            // También abrir el modal al hacer clic en el checkbox
            consentCheckbox.addEventListener('click', function(event) {
                // Si no está marcado, no hacemos nada
                if (!this.checked) {
                    privacyContainer.classList.remove('privacy-accepted');
                    return;
                }
                
                // Si no ha aceptado previamente, abrimos el modal
                if (localStorage.getItem('dataConsent') !== 'accepted') {
                    event.preventDefault(); // Evitamos que se marque el checkbox
                    consentModal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            });
            
            // Cerrar el modal con el botón X
            closeButton.addEventListener('click', function() {
                consentModal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restaurar scroll
            });
            
            // Cerrar el modal al hacer clic fuera del contenido
            consentModal.addEventListener('click', function(event) {
                if (event.target === consentModal) {
                    consentModal.style.display = 'none';
                    document.body.style.overflow = 'auto'; // Restaurar scroll
                }
            });
            
            // Cerrar el modal de rechazo
            closeRejectButton.addEventListener('click', function() {
                rejectModal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restaurar scroll
            });
            
            // Cerrar el modal de éxito
            closeSuccessButton.addEventListener('click', function() {
                successModal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restaurar scroll
                // Opcional: redirigir o resetear el formulario después de cerrar
                document.getElementById('servicioForm').reset();
            });
            
            // Manejar el botón Aceptar
            acceptButton.addEventListener('click', function(event) {
                event.preventDefault();
                localStorage.setItem('dataConsent', 'accepted');
                consentCheckbox.checked = true;
                consentModal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restaurar scroll
                // Cambiar el color del texto a verde
                privacyContainer.classList.add('privacy-accepted');
            });
            
            // Manejar el botón Rechazar
            rejectButton.addEventListener('click', function(event) {
                event.preventDefault();
                localStorage.setItem('dataConsent', 'rejected');
                consentCheckbox.checked = false;
                consentModal.style.display = 'none';
                // Quitar la clase para que vuelva a rojo
                privacyContainer.classList.remove('privacy-accepted');
                // Mostrar el modal de notificación de rechazo
                rejectModal.style.display = 'flex';
            });
        });
        
        // Script para la función de autocompletado de ubicación
        const ubicacionInput = document.getElementById('ubicacion');
        const ubicacionesList = document.getElementById('ubicaciones');
        
        ubicacionInput.addEventListener('input', async () => {
            const query = ubicacionInput.value;
            if (query.length > 2) {
                try {
                    const response = await fetch(`https://maps.googleapis.com/maps/api/place/autocomplete/json?input=${query}&types=address&location=21.019418,-89.617202&radius=50000&key=TU_API_KEY`);
                    const data = await response.json();
                    
                    ubicacionesList.innerHTML = '';
                    data.predictions.forEach(prediction => {
                        const option = document.createElement('option');
                        option.value = prediction.description;
                        ubicacionesList.appendChild(option);
                    });
                } catch (error) {
                    console.error('Error al obtener sugerencias:', error);
                }
            }
        });
        
        // Función para validar y mostrar modal de éxito al enviar
        function validarYEnviarFormulario(event) {
            event.preventDefault(); // Detener el envío normal del formulario
            
            // Primero validamos como antes
            if (validarFormulario()) {
                // Si la validación es exitosa, mostramos el modal de éxito
                document.getElementById('successModal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
                
                // También se podría enviar el formulario por AJAX aquí si se desea
                // const formData = new FormData(document.getElementById('servicioForm'));
                // fetch('procesar_formulario.php', {
                //     method: 'POST',
                //     body: formData
                // })
                
                return false; // No enviar el formulario de manera tradicional
            }
            
            return false; // No enviar el formulario si la validación falla
        }
        
        function validarFormulario() {
            const nombre = document.getElementById('nombre');
            const telefono = document.getElementById('telefono');
            const email = document.getElementById('email');
            const ubicacion = document.getElementById('ubicacion');
            const descripcion = document.getElementById('descripcion');
            const consentimiento = document.getElementById('consentimiento');

            // Validación de consentimiento
            if (!consentimiento.checked) {
                alert('Debe aceptar la política de privacidad para continuar');
                return false;
            }

            // Verificar que hayamos aceptado la política de privacidad
            if (localStorage.getItem('dataConsent') !== 'accepted') {
                alert('Debe abrir y aceptar la política de privacidad para continuar');
                return false;
            }

            // Validación personalizada de nombre
            if (!/^[A-Za-záéíóúÁÉÍÓÚñÑ\s]{3,50}$/.test(nombre.value)) {
                alert('Por favor ingrese un nombre válido');
                nombre.focus();
                return false;
            }

            // Validación personalizada de teléfono
            if (!/^[0-9]{3}[0-9]{3}[0-9]{4}$/.test(telefono.value)) {
                alert('Por favor ingrese un número de teléfono válido (Formato: 0123456789)');
                telefono.focus();
                return false;
            }

            // Validación de email si se proporciona
            if (email.value && !/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email.value)) {
                alert('Por favor ingrese un correo electrónico válido');
                email.focus();
                return false;
            }

            // Validación de ubicación
            if (ubicacion.value.length < 5) {
                alert('Por favor ingrese una ubicación válida (mínimo 5 caracteres)');
                ubicacion.focus();
                return false;
            }

            // Validación de descripción
            if (descripcion.value.length < 10 || descripcion.value.length > 500) {
                alert('La descripción debe tener entre 10 y 500 caracteres');
                descripcion.focus();
                return false;
            }

            return true;
        }
    </script>
</body>
</html>